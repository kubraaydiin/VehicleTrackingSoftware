@model IEnumerable<VehicleTrackingSoftware.Data.Entities.Vehicle>

<style>
    .row {
        margin: 10px;
    }

    .car-header {
        font-weight: bold;
    }

    .car-item {
        padding: 4px;
    }

        .car-item:hover {
            background-color: #eee;
            cursor: pointer;
        }

    #googleMap {
        width: 100%;
        height: 300px;
        margin: 10px auto;
    }
</style>

<div class="container">
    <div class="row">
        <div class="col-lg-6">
            <div class="container-fluid">
                <div class="car-header row">
                    <div class="col">Araç Plakası</div>
                    <div class="col">Başlangıç</div>
                    <div class="col">Hedef</div>
                </div> <hr />

                <div id="items">
                    @foreach (var item in Model)
                    {
                        <div class="car-item row">
                            <div id="numberPlate" class="col">@item.NumberPlate</div>
                            <div id="startingPoint" class="col">@item.StartingPoint</div>
                            <div id="destination" class="col">@item.Destination</div>
                        </div>
                    }
                </div>

            </div>
        </div>
        <div class="col-lg-6">
            <div class="container-fluid">
                <div class="row" style="flex-direction:row; justify-content:space-around; font-weight: bold">
                    <div id="distance" class="col">Mesafe: -</div>
                    <div id="duration" class="col">Süre: -</div>
                </div>
                <hr />
                <div id="googleMap">
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyDDJsOYQHqEKmYCIQuI6LnTWktsi6TvXCg" type="text/javascript"></script>
<script>
    function calculate(fromCity, toCity) {
        let request = {
            origin: fromCity,
            destination: toCity,
            travelMode: google.maps.TravelMode.DRIVING,
        }

        directionsService.route(request, function (result, status) {
            if (status == google.maps.DirectionsStatus.OK) {
                const distance = document.querySelector('#distance');
                const duration = document.querySelector('#duration');
                distance.innerHTML = "Mesafe: " + result.routes[0].legs[0].distance.text;
                duration.innerHTML = "Süre: " + result.routes[0].legs[0].duration.text;
                directionsDisplay.setDirections(result);
            }
        })
    }

    let myLocation = {
        lat: 41.0082,
        lng: 28.9784
    }

    let mapOptions = {
        center: myLocation,
        zoom: 7,
        mapTypeId: google.maps.MapTypeId.ROADMAP
    }

    let map = new google.maps.Map(document.getElementById('googleMap'), mapOptions);

    var directionsService = new google.maps.DirectionsService();
    var directionsDisplay = new google.maps.DirectionsRenderer();

    directionsDisplay.setMap(map);

    var parentElement = document.querySelector("#items");
    var rowChildren = document.querySelectorAll(".car-item");
    rowChildren.forEach(function (element, index) {
        element.addEventListener("click", function () {
            calculate(element.children[1].outerText, element.children[2].outerText)
        });
    });
</script>